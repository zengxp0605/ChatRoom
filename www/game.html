<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
       <title>Game</title>
    </head>
    <body>
        <div id="wrapper">
            <h3>Game.html</h3>   
            <table>
                <tr>
                    <td>cmd</td>
                    <td><input type="text" id="cmd" value="game::test"></td>
                </tr>
                <tr>
                    <td>params</td>
                    <td><textarea id="params" id="" cols="30" rows="5">test:tt</textarea></td>
                </tr>
                <tr>
                    <td></td>
                    <td><button onclick="Global.sendCmd()">send cmd</button></td>
                </tr>
            </table>
        </div>
        <script src="/scripts/jquery-1.8.0.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        <script>
        
            var socket, Global = {};
            $(function(){
                'use strict';
                socket = io.connect();
                socket.on('router',(data) => {
                    console.info('router from server: ', data); 
                });

                Global.sendCmd = () => {
                    var data = {
                        cmd : $('#cmd').val(),
                        params : _getParams(),
                    }
                    Global.emit(data);
                };
                Global.emit = (data) => {
                    console.info('send from client: ', data);
                    socket.emit('router',data);
                };
                var _getParams = () => {
                    let _params = {},
                        str = $('#params').val();
                        str.split('\n').map(function(s){
                            var _c = s.split(':');
                            _params[_c[0]] = _c[1] ? _c[1] : null;
                        });
                    return _params;    
                };
            });    
        </script>
    </body>
</html>